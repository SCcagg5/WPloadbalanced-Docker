version: '3.3'
networks:
   back-tier:
     driver: bridge
   front-tier:
     driver: bridge


services:
   db:
     image: mariadb
     restart: always
     environment:
       MYSQL_ROOT_PASSWORD: example
       MYSQL_DATABASE: wordpress
       MYSQL_USER: wordpress
       MYSQL_PASSWORD: wordpress
     links:
       - frontweb
     networks:
       - back-tier

   adminer:
     image: adminer
     restart: always
     links:
       - db
     ports:
       - 8080:8080
              
   frontweb:
     image: wordpress:latest
     ports:
       - 80
     networks:
       - back-tier
       - front-tier
     restart: always
     environment:
       WORDPRESS_DB_HOST: db:3306
       WORDPRESS_DB_USER: wordpress
       WORDPRESS_DB_PASSWORD: wordpress
       WORDPRESS_DB_NAME: wordpress

   lb:
     image: dockercloud/haproxy
     ports:
       - 80:80
     links:
       - frontweb
     networks:
       - front-tier
       - back-tier
     volumes:
       - /var/run/docker.sock:/var/run/docker.sock

volumes:
   db_data: {}